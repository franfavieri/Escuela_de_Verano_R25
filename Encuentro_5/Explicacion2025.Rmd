---
title: "Documentaci√≥n en R"
subtitle: Material adaptado de Pablo Tiscornia
date: ''
output:
  html_document:
    toc: true
    df_print: paged
  html_notebook:
    toc: true
    toc_float: true
---

### R Markdown: Introducci√≥n

Los archivos R Markdown nos permiten combinar c√≥digo, resultados y texto. El objetivo de esta clase es aprender a trabajar bajo dicho entorno para facilitar tres aplicaciones:

-   Documentar el trabajo que realizamos, incluyendo comentarios sobre los procedimientos.
-   Compartir c√≥digo y resultados con personas que tambi√©n trabajan en R.
-   Compartir resultados con personas que NO trabaja en R .

Las presentes notas de clase est√°n basadas en el libro [R4DS](https://es.r4ds.hadley.nz/r-markdown.html) y las [cheatsheets](https://www.rstudio.com/resources/cheatsheets/). Tambi√©n se recomienda el libro [R Markdown: The Definitive Guide](https://bookdown.org/yihui/rmarkdown/).

### Requisitos

Necesitamos instalar y cargar el paquete **rmarkdown**. Por lo general no hace falta hacerlo porque RStudio realiza esto autom√°ticamente cuando es necesario.

### Markdown b√°sico

Se trata de un archivo de extensi√≥n **.Rmd**. Contiene en su estructura tres tipos importantes de contenido:

-   Un encabezado YAML ("Yet another markup lenguage") rodeado de - - -

```         
---
title: "El t√≠tulo de nuestro informe"
date: Febrero 2025
output: html_document
---
```

-   Bloques de c√≥digo de R rodeado de \`\`\`.

![](img/Selection_008.png)

-   Texto con formato

Cuando abrimos un archivo **.Rmd**, obtenemos una interfaz de notebook donde el c√≥digo y el output se encuentran intercalados (en lugar de aparecer el output s√≥lo en la consola, panel de plots y/o modificaciones en el entorno de trabajo).

Los bloques de c√≥digo se pueden ejecutar haciendo click en el √≠cono **ejecutar** (el bot√≥n de *Play* en la parte superior/derecha del bloque), o presionando `Cmd/Ctrl + Shift + Enter`. RStudio ejecuta el c√≥digo y muestra los resultados incustrados en el c√≥digo.

Para producir un reporte completo que contenga todo el texto, c√≥digo y resultados, podemos clickear en **Knit** o presionar `Cmd/Ctrl + Shift + K`. Esto mostrar√° el reporte en el panel *Viewer* y crear√° un archivo HTML independiente que podremos compartir con otros.

### ¬øQu√© es "knitear"?

En el contexto de RMarkdown, es el proceso que convierte un archivo .Rmd (R Markdown) en un documento final en formatos como HTML, PDF o Word.

Este proceso es gestionado por el paquete knitr y ejecuta el c√≥digo R dentro del documento, integrando los resultados en el texto final.

üîπ Para compilar manualmente un archivo .Rmd en RStudio, hacer clic en el bot√≥n "Knit" o usar el comando. **"Knit"** significa **"tejer"** el documento combinando texto, c√≥digo y resultados en un formato legible.

### Formateo de texto

La prosa en los archivos .Rmd est√° escrita en Markdown, una colecci√≥n simple de convenciones para dar formato a archivos de texto plano. Markdown est√° dise√±ado para ser f√°cil de leer y f√°cil de escribir, siendo tambi√©n muy f√°cil de aprender. Del *Cheatsheet*:

![](img/Selection_001.png)

### Bloques de c√≥digo

Como ya mencionamos, para ejecutar c√≥digo dentro de un documento R Markdown, necesitamos insertar un bloque (*Chunk*). Hay tres maneras para hacerlo:

-   El atajo de teclado `Cmd/Ctrl + Alt + I`
-   El icono ‚ÄúInsertar‚Äù en la barra de edici√≥n (`Insert > R`)
-   Tipear manualmente los delimitadores de bloque ```` ```{r} ```` y ```` ``` ````.

Obviamente, se recomienda usar el atajo de teclado porque, a largo plazo, ahorra mucho tiempo. El c√≥digo se puede seguir corriendo con `Cmd/Ctrl + Enter` l√≠nea a l√≠nea. Sin embargo, los bloques de c√≥digo tienen otro atajo de teclado: `Cmd/Ctrl + Shift + Enter`, que ejecuta todo el c√≥digo en el bloque.

Un bloque deber√≠a ser relativamente aut√≥nomo, y enfocado alrededor de una sola tarea. Las siguientes secciones decriben el encabezado de bloque que consiste en ```` ```{r ````, seguido por un nombre opcional para el bloque, seguido entonces por **opciones separadas por comas**, y concluyendo con `}`. Inmediatamente despu√©s sigue tu c√≥digo de R el bloque y el fin del bloque se indica con un ```` ``` ```` final.

Hay un nombre de bloque que tiene comportamiento especial: `setup`. Cuando nos encontramos en modo notebook, el bloque llamado setup se ejecutar√° autom√°ticamente una vez, antes de ejecutar cualquier otro c√≥digo.

### Opciones en los bloques de c√≥digo

La salida de los bloques puede personalizarse con **options**, argumentos suministrados en el encabezado del bloque. Knitr provee casi 60 opciones para que puedas usar para personalizar tus bloques de c√≥digo, la lista completa puede verse en <http://yihui.name/knitr/options/>.

Las que m√°s utilizamos nosotros son:

-   `eval = FALSE` evita que c√≥digo sea evaluado. (Y obviamente si el c√≥digo no es ejecutado no se generaran resultados). Esto es √∫til para mostrar c√≥digos de ejemplo, o para deshabilitar un gran bloque de c√≥digo sin comentar cada l√≠nea.

-   `include = FALSE` ejecuta el c√≥digo, pero no muestra el c√≥digo o los resultados en el documento final. Usa esto para el c√≥digo de configuracion que no quieres que abarrote tu reporte.

-   `echo = FALSE` evita que se vea el c√≥digo, pero no los resultados en el archivo final. Utiliza esto cuando quieres escribir reportes enfocados a personas que no quieren ver el c√≥digo subyacente de R.

-   `message = FALSE` o `warning = FALSE` evita que aparezcan mensajes o advertencias en el archivo final.

-   `results = 'hide'` oculta el output impreso; `fig.show = 'hide'` oculta gr√°ficos.

-   `error = TRUE` causa que el render contin√∫e incluso si el c√≥digo devuelve un error. Esto es algo que raramente quer√©s incluir en la version final de tu reporte.

Contamos con algunas de estas opciones en el men√∫ de **Configuraci√≥n** en la parte superior-derecha del *Chunk* de c√≥digo.

### Tablas

Por defecto, las tablas se imprimen tal como salen como en la consola. Si queremos que los datos tengan un formato adicional podemos usar la funci√≥n `knitr::kable()`. A√∫n m√°s, recomendamos mirar los paquetes [kableExtra](https://haozhu233.github.io/kableExtra/awesome_table_in_html.html#grouped_columns__rows) y [formattable](https://www.displayr.com/formattable/).

Para una mayor personalizaci√≥n, se pueden considerar tambi√©n los paquetes `xtable`, `stargazer`, `pander`, `tables`, y `ascii`. Cada uno provee un set de herramientas para generar tablas con formato a partir c√≥digo de R.

### Opciones globales

Algunas de las opciones default que tienen los bloques de c√≥digo pueden no ajustarse a tus necesidades. Podemos setear cambios incluyendo `knitr::opts_chunk$set()` en un bloque de c√≥digo. Por ejemplo:

`knitr::opts_chunk$set(echo = FALSE)`

Ocultar√° el c√≥digo por defecto, as√≠ que s√≥lo mostrar√° los bloques que deliberadamente elegimos mostrar con `echo = TRUE`.

### C√≥digo en la l√≠nea

Otra forma de incluir c√≥digo R en un documento R Markdown es insertarlo directamente en el texto, encerrando entre ``` `` ``` `"r codigo"`. Esto puede ser muy √∫til si queremos mencionar propiedades o atributos de los datos o resultados en el texto.

Cuando insertamos n√∫meros en el texto, `format()` nos va a ser de mucha ayuda. Esto permite establecer el n√∫mero de digitos para que no imprimas con un grado r√≠diculo de precisi√≥n, y una big.mark para hacer que los n√∫meros sean mas f√°ciles de leer. Por ejemplo, en una funci√≥n de ayuda:

```{r echo=TRUE, message=FALSE, warning=FALSE}
formato <- function(x){
  format(x, digits = 2, big.mark = ".", decimal.mark = ",")
  }
formato(3452345)
formato(.12358124331)
```

### Formatos

Hasta ahora vimos R Markdown para producir documentos HTML:

```         
---
title: "Clase"  
output: html_document
---
```

Para sobrescribir los par√°metros predeterminados se necesita usar un campo de output extendido. Por ejemplo, si queremos generar un `html_document` con una tabla de contenido flotante, usamos:

```         
---
title: "Clase"
output:
  html_document:
    toc: true
    toc_float: true
---
```

Para los `html_document` otra opci√≥n es hacer que los fragmentos de c√≥digo est√©n escondidos por defecto, pero visibles con un *click*:

```         
---
title: "Clase"
output:
  html_document:
    code_folding: hide
---
```

### Otros formatos

Hay todo un n√∫mero de variaciones b√°sicas para generar diferentes tipos de documentos:

-   `pdf_document` crea un PDF con LaTeX (un sistema de c√≥digo abierto de composici√≥n de textos), que necesitar√°s instalar. RStudio te notificar√° si no lo tienes.

-   `word_document` para documentos de Microsoft Word (.docx).

-   `odt_document` para documentos de texto OpenDocument (.odt).

y m√°s!

### Notebooks

Un notebook, `html_notebook` ("cuaderno" en espa√±ol), es una variaci√≥n de un `html_document`. Las salidas de los dos documentos son muy similares, pero tienen prop√≥sitos distintos. Un `html_document` est√° enfocado en la comunicaci√≥n con los encargados de la toma de decisiones, mientras que un notebook est√° enfocado en colaborar con otros cient√≠ficos de datos. Estos prop√≥sitos diferentes llevan a usar la salida HTML de diferentes maneras. Ambas salidas HTML contendr√°n la salida renderizada, pero **el notebook tambi√©n contendr√° el c√≥digo fuente completo**. Esto significa que podemos usar el archivo `.nb.html` generado por el notebook de dos maneras:

-   Podemos verlo en un navegador web, y ver la salida generada. A diferencia del `html_document`, esta renderizaci√≥n siempre incluye una copia incrustada del c√≥digo fuente que lo gener√≥.

-   Podemos editarlo en RStudio. Cuando abramos un archivo `.nb.html`, RStudio autom√°ticamente recrear√° el archivo `.Rmd` que lo cre√≥.

### Publicar

Desde RStudio tenemos la posibilidad de publicar nuestros Markdown en [RPubs](https://rpubs.com/) de forma gratuita, desde el bot√≥n **Publish document**. Todo lo que subamos a nuestra cuenta de RPubs ser√° p√∫blico.

### FlexDashboard

Los dashboards ("tableros de control" en espa√±ol) son una forma √∫til de comunicar grandes cantidades de informaci√≥n de forma visual y r√°pida. Flexdashboard hace que sea particularmente f√°cil crear dashboards usando R Markdown y proporciona una convenci√≥n de c√≥mo los encabezados afectan el dise√±o:

-   Cada encabezado de Nivel 1 (\#) comienza una nueva p√°gina en el dashboard.
-   Cada encabezado de Nivel 2 (\##) comienza una nueva columna.
-   Cada encabezado de Nivel 3 (\###) comienza una nueva fila.

Flexdashboard tambi√©n proporciona herramientas simples para crear barras laterales, tabuladores, cuadros de valores y medidores. Podemos obtener m√°s informaci√≥n (en ingl√©s) acerca de Flexdashboard en <http://rmarkdown.rstudio.com/flexdashboard/>.
